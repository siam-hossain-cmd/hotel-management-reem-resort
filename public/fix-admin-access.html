<!DOCTYPE html>
<html>
<head>
    <title>Fix Admin Access Issues</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, updateDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDQdwrJPIl0rIMh5b9JaKOD9Zz3bNJd1R4",
            authDomain: "invoice-management-d6ea7.firebaseapp.com",
            projectId: "invoice-management-d6ea7",
            storageBucket: "invoice-management-d6ea7.appspot.com",
            messagingSenderId: "286610896823",
            appId: "1:286610896823:web:2ee1c5e7c124c1b7a8d6f7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Updated Admin permissions
        const ADMIN_PERMISSIONS = [
            'view_dashboard',
            'create_invoice',
            'view_invoices',
            'edit_invoices',
            'export_invoices',
            'view_customers',
            'create_customers',
            'edit_customers',
            'view_rooms',
            'create_rooms',
            'edit_rooms',
            'view_reports',
            'create_reports',
            'export_reports'
        ];

        async function fixAdminAccess() {
            try {
                console.log('üîß Fixing Admin access issues...');
                document.getElementById('output').innerHTML += 'üîß Fixing Admin access issues...<br><br>';
                
                // Get all Admin users
                const adminQuery = query(collection(db, 'users'), where('role', '==', 'Admin'));
                const adminSnapshot = await getDocs(adminQuery);
                
                if (adminSnapshot.empty) {
                    document.getElementById('output').innerHTML += '‚ùå No Admin users found<br>';
                    return;
                }
                
                document.getElementById('output').innerHTML += `üìä Found ${adminSnapshot.size} Admin users to fix<br><br>`;
                
                for (const userDoc of adminSnapshot.docs) {
                    const userData = userDoc.data();
                    const userId = userDoc.id;
                    
                    document.getElementById('output').innerHTML += `üë§ Fixing: ${userData.email}<br>`;
                    
                    // Update with correct permissions and ensure active status
                    await updateDoc(doc(db, 'users', userId), {
                        permissions: ADMIN_PERMISSIONS,
                        isActive: true, // Ensure active
                        status: 'active',
                        updatedAt: new Date().toISOString()
                    });
                    
                    document.getElementById('output').innerHTML += 
                        `&nbsp;&nbsp;‚úÖ Updated permissions (${ADMIN_PERMISSIONS.length} total)<br>` +
                        `&nbsp;&nbsp;‚úÖ Ensured active status<br>` +
                        `&nbsp;&nbsp;‚úÖ Can access: Reports, Rooms, Create Invoice, etc.<br><br>`;
                }
                
                document.getElementById('output').innerHTML += 
                    'üéâ <strong>All Admin users fixed!</strong><br><br>' +
                    'üìã <strong>Admin users can now access:</strong><br>' +
                    '&nbsp;&nbsp;‚Ä¢ Dashboard ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ Create Invoice ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ View/Edit Invoices ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ View/Edit Customers ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ View/Edit Rooms ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ View Reports ‚úÖ<br>' +
                    '&nbsp;&nbsp;‚Ä¢ Export Data ‚úÖ<br><br>' +
                    '‚ùå <strong>Admin users CANNOT access:</strong><br>' +
                    '&nbsp;&nbsp;‚Ä¢ User Management (MasterAdmin only)<br>' +
                    '&nbsp;&nbsp;‚Ä¢ Admin Management (MasterAdmin only)<br>' +
                    '&nbsp;&nbsp;‚Ä¢ Settings (MasterAdmin only)<br>';
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('output').innerHTML += `‚ùå Error: ${error.message}<br>`;
            }
        }

        window.addEventListener('load', () => {
            document.getElementById('fixButton').addEventListener('click', fixAdminAccess);
        });
    </script>
</head>
<body>
    <h1>Fix Admin Access Issues</h1>
    <p>This will fix permission issues for Admin users so they can access all appropriate pages.</p>
    
    <button id="fixButton">Fix Admin Access</button>
    
    <h2>Results:</h2>
    <div id="output" style="background: #f5f5f5; padding: 10px; min-height: 100px; font-family: monospace; white-space: pre-wrap;"></div>
</body>
</html>