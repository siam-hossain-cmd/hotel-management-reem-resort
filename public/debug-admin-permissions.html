<!DOCTYPE html>
<html>
<head>
    <title>Debug Admin Permissions</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDQdwrJPIl0rIMh5b9JaKOD9Zz3bNJd1R4",
            authDomain: "invoice-management-d6ea7.firebaseapp.com",
            projectId: "invoice-management-d6ea7",
            storageBucket: "invoice-management-d6ea7.appspot.com",
            messagingSenderId: "286610896823",
            appId: "1:286610896823:web:2ee1c5e7c124c1b7a8d6f7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function debugAdminPermissions() {
            try {
                console.log('üîç Checking Admin user permissions...');
                document.getElementById('output').innerHTML += 'üîç Checking Admin user permissions...<br><br>';
                
                const usersSnapshot = await getDocs(query(collection(db, 'users'), where('role', '==', 'Admin')));
                
                if (usersSnapshot.empty) {
                    document.getElementById('output').innerHTML += '‚ùå No Admin users found<br>';
                    return;
                }
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    
                    document.getElementById('output').innerHTML += 
                        `üë§ <strong>${userData.email}</strong> (Admin)<br>` +
                        `&nbsp;&nbsp;isActive: ${userData.isActive}<br>` +
                        `&nbsp;&nbsp;status: ${userData.status}<br>` +
                        `&nbsp;&nbsp;permissions: ${userData.permissions ? userData.permissions.length : 0} total<br><br>`;
                    
                    if (userData.permissions && userData.permissions.length > 0) {
                        document.getElementById('output').innerHTML += 'üìã <strong>Permissions List:</strong><br>';
                        userData.permissions.forEach(permission => {
                            document.getElementById('output').innerHTML += `&nbsp;&nbsp;‚úÖ ${permission}<br>`;
                        });
                        document.getElementById('output').innerHTML += '<br>';
                        
                        // Check specific permissions
                        const checkPermissions = [
                            'view_reports',
                            'view_rooms', 
                            'create_invoice',
                            'view_invoices',
                            'view_customers'
                        ];
                        
                        document.getElementById('output').innerHTML += 'üîç <strong>Key Permission Checks:</strong><br>';
                        checkPermissions.forEach(perm => {
                            const hasIt = userData.permissions.includes(perm);
                            const emoji = hasIt ? '‚úÖ' : '‚ùå';
                            document.getElementById('output').innerHTML += `&nbsp;&nbsp;${emoji} ${perm}<br>`;
                        });
                    } else {
                        document.getElementById('output').innerHTML += '‚ö†Ô∏è <strong>No permissions found!</strong><br>';
                    }
                    
                    document.getElementById('output').innerHTML += '<br>---<br><br>';
                });
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('output').innerHTML += `‚ùå Error: ${error.message}<br>`;
            }
        }

        window.addEventListener('load', () => {
            document.getElementById('debugButton').addEventListener('click', debugAdminPermissions);
        });
    </script>
</head>
<body>
    <h1>Debug Admin Permissions</h1>
    <p>This will check what permissions Admin users actually have in Firestore.</p>
    
    <button id="debugButton">Debug Admin Permissions</button>
    
    <h2>Results:</h2>
    <div id="output" style="background: #f5f5f5; padding: 10px; min-height: 100px; font-family: monospace; white-space: pre-wrap;"></div>
</body>
</html>